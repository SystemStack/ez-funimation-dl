(()=>{"use strict";var e={898:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GetAuthHeader=void 0;const a=o(225),i=n(o(362)),r=o(562),s=".accesstoken";t.GetAuthHeader=async function(){return`Token ${await async function(){let e=await async function(){return await a.readFile(s,"utf8")}();return""===e&&(e=await async function(){const e=await i.default([{type:"text",name:"username",message:"Funimation Username (Never stored)"},{type:"password",name:"password",message:"Funimation Password (Never stored)"}]);return r.Login(e)}(),await async function(e){return await a.writeFile(s,e)}(e)),e}()}`}},913:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GetPolicyParam=t.GetShowId=t.episodeCatalogRoute=t.episodeSeasonRoute=t.catalogSearchRoute=t.idSearchRoute=t.historyRoute=t.loginRoute=t.userAgent=t.s3Bucket=t.episodeAPI=t.downloadAPIRoute=t.SOURCE_API=void 0,t.SOURCE_API="https://prod-api-funimationnow.dadcdigital.com/api/",t.downloadAPIRoute="https://vmfst-api.prd.funimationsvc.com/FunimationStoreFront/",t.episodeAPI="https://d33et77evd9bgg.cloudfront.net/FunimationStoreFront/",t.s3Bucket="https://d132fumi6di1wa.cloudfront.net/exp/FunimationStoreFront/";const o="https://derf9v1xhwwx1.cloudfront.net/image/upload/oth/FunimationStoreFront/";t.userAgent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36 Edg/91.0.864.59",t.loginRoute=`${t.SOURCE_API}auth/login/`,t.historyRoute=`${t.SOURCE_API}source/funimation/history/`,t.idSearchRoute=`${t.SOURCE_API}source/funimation/search/?q=`,t.catalogSearchRoute=`${t.SOURCE_API}source/catalog/title/`,t.episodeSeasonRoute=`${t.SOURCE_API}funimation/episodes/`,t.episodeCatalogRoute=`${t.SOURCE_API}source/catalog/episode/`,t.GetShowId=e=>{const t=e.thumb.length?e.thumb.split(o)[1].split("/")[0]:e.poster.length?e.poster.split(o)[1].split("/")[0]:"";if(""==t)throw"Could not find download source";return t},t.GetPolicyParam=e=>{const t={Statement:[{Resource:e,Condition:{DateLessThan:{"AWS:EpochTime":Number(new Date)-1626772333e3}}}]};return Buffer.from(JSON.stringify(t)).toString("base64")}},263:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GetEpisodeUrls=void 0;const n=o(786),a=o(898),i=o(913);t.GetEpisodeUrls=async function(e,t="English"){const o=await a.GetAuthHeader(),r=new Set(e.flatMap((e=>e.id))),s=await async function(e,t,o){const r=await a.GetAuthHeader();return n(`${i.episodeSeasonRoute}?sort=order&sort_direction=ASC&limit=-1&offset=-1&language=${o}&title_id=${t}`,{method:"GET",proxy:!0,headers:{"user-agent":i.userAgent,Authorization:r}}).then((e=>e.json())).then((t=>[...new Set(t.items.flatMap((t=>{if(e.has(t.item.seasonId))return`${i.episodeCatalogRoute}${t.item.titleSlug}/${t.item.episodeSlug}/`})).filter((e=>null!=e)))]))}(r,e[0].parent.id,t);return(await Promise.all(s.map((async e=>await async function(e,t,o){return n(e,{method:"GET",proxy:!0,headers:{"user-agent":i.userAgent,Authorization:o}}).then((e=>e.json())).then((e=>{for(const o of e.items[0].media[0].mediaChildren)if("m3u8"===o.ext&&o.language===t)return`${i.downloadAPIRoute}${o.filePath.split("FunimationStoreFront/")[1]}`})).catch((e=>e))}(e,t,o))))).filter((e=>void 0!==e))}},607:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(o(362)),i=o(263),r=o(463);async function s(e){const t={type:"autocomplete",name:"animeId",message:"Which one is right? (autocomplete or arrow keys)",choices:e.map((e=>({title:e.title,description:e.description,value:e.id})))};return(await a.default(t)).animeId}async function u(e){let t=[];for(;0===t.length;){const o={type:"multiselect",name:"Seasons",message:"Select seasons",choices:e.map((e=>({title:e.title,description:e.parent.synopsis,value:e})))};t=(await a.default(o)).Seasons,0===t.length&&console.warn(" ~~~~~~~~~~~~~~~~~~~~~~SPACE BAR TO SELECT~~~~~~~~~~~~~~~~~~~~~~\n","~~~~~~~~~~~~~~~~~~~~~~SPACE BAR TO SELECT~~~~~~~~~~~~~~~~~~~~~~\n","~~~~~~~~~~~~~~~~~~~~~~SPACE BAR TO SELECT~~~~~~~~~~~~~~~~~~~~~~")}return t}(async()=>{for(;;){const e=await r.IdSearch(),t=await s(e),o=await r.CatalogSearch(t),n=await u(o),a=await i.GetEpisodeUrls(n);console.log(a)}})()},463:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CatalogSearch=t.IdSearch=void 0;const a=n(o(362)),i=o(562);async function r(){const e=await a.default([{type:"text",name:"title",message:"Search FunimationðŸ”Ž"}]);return i.QueryIds(e)}t.IdSearch=async function(){let e=[];for(;0===e.length;)e=await r(),0===e.length&&console.warn("No results");return e},t.CatalogSearch=async function(e){return await async function(e){return await i.QueryCatalog(e)}({animeId:e})}},562:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.QueryCatalog=t.QueryIds=t.Login=void 0;const n=o(786),a=o(898),i=o(913);t.Login=async function(e){return await n(i.loginRoute,{method:"POST",body:JSON.stringify(e),headers:{"user-agent":i.userAgent},proxy:!0}).then((e=>e.json())).then((e=>e.token)).catch((e=>e))},t.QueryIds=async function(e){const t=await a.GetAuthHeader();return await n(`${i.idSearchRoute}${e.title}`,{method:"GET",proxy:!0,headers:{"user-agent":i.userAgent,Authorization:t}}).then((e=>e.json())).then((e=>e?.items?.hits)).catch((e=>e))},t.QueryCatalog=async function(e){const t=await a.GetAuthHeader();return await n(`${i.catalogSearchRoute}${e.animeId}/`,{method:"GET",proxy:!0,headers:{"user-agent":i.userAgent,Authorization:t}}).then((e=>e.json())).then((e=>e?.items[0])).then((e=>e.children.filter((e=>"season"===e.mediaCategory)))).catch((e=>e))}},225:e=>{e.exports=require("fs/promises")},786:e=>{e.exports=require("node-fetch")},362:e=>{e.exports=require("prompts")}},t={},o=function o(n){var a=t[n];if(void 0!==a)return a.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,o),i.exports}(607);for(var n in o)this[n]=o[n];o.__esModule&&Object.defineProperty(this,"__esModule",{value:!0})})();